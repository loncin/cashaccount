<view class="container">
  <!-- èµ„äº§æ¦‚è§ˆ -->
  <view class="overview-card">
    <view class="card-header">
      <view class="title">å‡€èµ„äº§</view>
      <view class="header-actions">
        <view class="export-btn" bindtap="importScreenshot">æˆªå›¾å¯¼å…¥</view>
        <view class="export-btn" bindtap="exportData">å¯¼å‡ºæ•°æ®</view>
      </view>
    </view>
    <view class="amount {{netAsset >= 0 ? 'plus' : 'minus'}}">{{netAsset}}</view>
    <view class="stats-row">
      <view class="stat-item">
        <text class="label">æœ¬æœˆæ”¶å…¥</text>
        <text class="value income">{{monthlyIncome}}</text>
      </view>
      <view class="stat-item">
        <text class="label">æœ¬æœˆæ”¯å‡º</text>
        <text class="value expense">{{monthlyExpense}}</text>
      </view>
    </view>
    
    <!-- é¢„ç®—è¿›åº¦ -->
    <view class="budget-section" bindtap="showBudgetModal">
      <view class="budget-info">
        <text class="label">æœ¬æœˆé¢„ç®—: {{budget > 0 ? budget : 'æœªè®¾ç½®'}}</text>
        <text class="remain" wx:if="{{budget > 0}}">å‰©ä½™: {{budgetRemain}}</text>
      </view>
      <view class="budget-progress" wx:if="{{budget > 0}}">
        <view class="progress-bar {{budgetPercent > 90 ? 'danger' : ''}}" style="width: {{budgetPercent}}%"></view>
      </view>
      <view class="set-hint" wx:else>ç‚¹å‡»è®¾ç½®æœ¬æœˆé¢„ç®—ï¼Œæ§åˆ¶æ¶ˆè´¹</view>
    </view>
  </view>

  <!-- é¢„ç®—è®¾ç½®å¼¹çª— -->
  <view class="modal" wx:if="{{showBudgetModal}}">
    <view class="modal-content">
      <view class="modal-title">è®¾ç½®æœ¬æœˆé¢„ç®—</view>
      <input class="modal-input" type="digit" placeholder="è¾“å…¥é¢„ç®—é‡‘é¢" bindinput="onBudgetInput" value="{{newBudget}}" focus />
      <view class="modal-footer">
        <button class="cancel" bindtap="hideBudgetModal">å–æ¶ˆ</button>
        <button class="confirm" bindtap="saveBudget">ä¿å­˜</button>
      </view>
    </view>
  </view>

  <!-- æœç´¢æ  -->
  <view class="search-bar">
    <icon type="search" size="14"></icon>
    <input type="text" placeholder="æœç´¢åˆ†ç±»æˆ–å¤‡æ³¨" value="{{searchKeyword}}" bindinput="onSearchInput" />
    <view class="calendar-icon" bindtap="goToCalendar">ğŸ“…</view>
    <icon type="clear" size="14" wx:if="{{searchKeyword}}" bindtap="clearSearch"></icon>
  </view>

  <!-- æ—¶é—´ç­›é€‰ -->
  <view class="filter-bar">
    <picker mode="date" fields="{{filterType}}" value="{{filterDate}}" bindchange="onDateChange">
      <view class="picker">
        {{filterDateDisplay}} â–¼
      </view>
    </picker>
    <view class="type-selector">
      <text class="{{filterType === 'day' ? 'active' : ''}}" bindtap="changeFilterType" data-type="day">å¤©</text>
      <text class="{{filterType === 'month' ? 'active' : ''}}" bindtap="changeFilterType" data-type="month">æœˆ</text>
      <text class="{{filterType === 'year' ? 'active' : ''}}" bindtap="changeFilterType" data-type="year">å¹´</text>
    </view>
  </view>

  <!-- æµæ°´åˆ—è¡¨ -->
  <scroll-view class="transaction-list" scroll-y>
    <view wx:if="{{filteredTransactions.length === 0}}" class="empty">æš‚æ— æ•°æ®</view>
    <view wx:for="{{filteredTransactions}}" wx:key="_id" class="transaction-item" bindtap="onItemClick" data-id="{{item._id}}">
      <view class="item-icon">{{item.categoryIcon || 'ğŸ“¦'}}</view>
      <view class="item-left">
        <view class="category">{{item.category}}</view>
        <view class="info">
          <text class="member">{{item.memberName}}</text>
          <text class="account-tag" wx:if="{{item.accountName}}">{{item.accountName}}</text>
          <text class="date">{{item.date}}</text>
          <text class="receipt-tag" wx:if="{{item.receiptUrl}}" catchtap="previewReceipt" data-url="{{item.receiptUrl}}">ğŸ“· å‡­è¯</text>
        </view>
      </view>
      <view class="item-right {{item.type === 'income' ? 'plus' : 'minus'}}">
        {{item.type === 'income' ? '+' : '-'}}{{item.amount}}
      </view>
    </view>
  </scroll-view>
</view>
