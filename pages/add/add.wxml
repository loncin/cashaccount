<view class="container">
  <view class="top-bar">
    <view class="home-btn" bindtap="goHome">ğŸ  é¦–é¡µ</view>
  </view>
  <view class="type-switch">
    <view class="switch-item {{type === 'expense' ? 'active expense' : ''}}" bindtap="changeType" data-type="expense">æ”¯å‡º</view>
    <view class="switch-item {{type === 'income' ? 'active income' : ''}}" bindtap="changeType" data-type="income">æ”¶å…¥</view>
  </view>

  <view class="form-container">
    <view class="form-item">
      <text class="label">é‡‘é¢</text>
      <input class="input" type="digit" placeholder="0.00" value="{{amount}}" bindinput="onAmountInput" focus />
      <view class="ocr-btn" bindtap="scanInvoice">
        <text>ğŸ“· è¯†åˆ«</text>
      </view>
    </view>

    <view class="form-item">
      <text class="label">é¡¹ç›®</text>
      <view class="picker-val" bindtap="showCategoryModal">
        {{categories[categoryIndex] ? (categories[categoryIndex].icon + ' ' + categories[categoryIndex].name) : 'è¯·é€‰æ‹©'}}
      </view>
    </view>

    <view class="form-item">
      <text class="label">æ—¥æœŸ</text>
      <view class="picker-val" bindtap="showCalendarModal">{{date}}</view>
    </view>

    <view class="form-item">
      <text class="label">æˆå‘˜</text>
      <picker bindchange="onMemberChange" value="{{memberIndex}}" range="{{memberNames}}">
        <view class="picker-val">{{memberNames[memberIndex] || 'è¯·é€‰æ‹©'}}</view>
      </picker>
    </view>

    <view class="form-item">
      <text class="label">è´¦æˆ·</text>
      <picker bindchange="onAccountChange" value="{{accountIndex}}" range="{{accountNames}}">
        <view class="picker-val">{{accountNames[accountIndex] || 'è¯·é€‰æ‹©'}}</view>
      </picker>
    </view>

    <view class="form-item">
      <text class="label">å¤‡æ³¨</text>
      <input class="input" placeholder="ç‚¹å‡»è¾“å…¥å¤‡æ³¨" value="{{note}}" bindinput="onNoteInput" />
    </view>

    <!-- å›¾ç‰‡å‡­è¯ -->
    <view class="form-item no-border">
      <text class="label">å‡­è¯</text>
      <view class="image-uploader">
        <view class="img-preview" wx:if="{{tempImagePath}}" bindtap="previewImage">
          <image src="{{tempImagePath}}" mode="aspectFill"></image>
          <view class="img-remove" catchtap="removeImage">Ã—</view>
        </view>
        <view class="upload-btn" bindtap="chooseImage" wx:else>
          <icon type="add" size="30" color="#ccc"></icon>
        </view>
      </view>
    </view>

    <!-- å‘¨æœŸæ€§è®°è´¦ -->
    <view class="form-item">
      <text class="label">å‘¨æœŸè®°è´¦</text>
      <switch checked="{{isRecurring}}" bindchange="onRecurringChange" color="#4facfe"></switch>
    </view>

    <view class="form-item" wx:if="{{isRecurring}}">
      <text class="label">é‡å¤å‘¨æœŸ</text>
      <picker bindchange="onPeriodChange" value="{{periodIndex}}" range="{{periods}}">
        <view class="picker-val">{{periods[periodIndex]}}</view>
      </picker>
    </view>
  </view>

  <button class="submit-btn {{type}}" bindtap="submit">{{isEdit ? 'ç¡®è®¤ä¿®æ”¹' : 'ä¿å­˜'}}</button>

  <!-- æ—¥å†å¼¹çª— -->
  <view class="calendar-modal {{showCalendar ? 'show' : ''}}">
    <view class="calendar-mask" bindtap="hideCalendarModal"></view>
    <view class="calendar-content">
      <view class="calendar-header">
        <view class="calendar-title">é€‰æ‹©æ—¥æœŸ</view>
        <view class="month-selector">
          <view class="month-arrow" bindtap="prevMonth">â—€</view>
          <view class="current-month">{{currentYear}}å¹´{{currentMonth}}æœˆ</view>
          <view class="month-arrow" bindtap="nextMonth">â–¶</view>
        </view>
        <view class="confirm-btn" bindtap="hideCalendarModal">ç¡®å®š</view>
      </view>
      <view class="weekdays">
        <view wx:for="{{['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­']}}" wx:key="*this">{{item}}</view>
      </view>
      <view class="days-grid">
        <view class="day-item {{item.isEmpty ? 'empty' : ''}} {{item.fullDate === date ? 'selected' : ''}}" 
              wx:for="{{calendarDays}}" 
              wx:key="fullDate" 
              bindtap="onDaySelect" 
              data-date="{{item.fullDate}}">
          {{item.day}}
        </view>
      </view>
    </view>
  </view>

  <!-- åˆ†ç±»å¼¹çª— -->
  <view class="category-modal {{showCategory ? 'show' : ''}}">
    <view class="category-mask" bindtap="hideCategoryModal"></view>
    <view class="category-content">
      <view class="category-header">
        <view class="category-title">é€‰æ‹©åˆ†ç±»</view>
        <view class="confirm-btn" bindtap="hideCategoryModal">å–æ¶ˆ</view>
      </view>
      <view class="category-grid">
        <view class="category-item {{index === categoryIndex ? 'selected' : ''}}" 
              wx:for="{{categories}}" 
              wx:key="name" 
              bindtap="onCategorySelect" 
              data-index="{{index}}">
          <view class="category-icon-wrapper">
            <text class="category-icon">{{item.icon}}</text>
          </view>
          <text class="category-name">{{item.name}}</text>
        </view>
      </view>
    </view>
  </view>
</view>
